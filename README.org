#+TITLE:   README
#+DATE:    April 13, 2021
#+SINCE:   <replace with next tagged release version>
#+STARTUP: inlineimages nofold

* Table of Contents :TOC_1:noexport:
- [[#description][Description]]
- [[#features][Features]]
- [[#installation-and-configuration][Installation and Configuration]]
- [[#caching][Caching]]
- [[#keybindings][Keybindings]]
- [[#change-logs][Change logs]]

* Description
Emacs [[https://github.com/wallabag/wallabag][Wallabag]] client.
#+attr_org: :width 600px
[[file:homepage.png]]

* Features

- [x] Request all entries
- [x] Request all tags
- [x] Add tags for one entry
- [x] Delete tag for one entry
- [x] Request format for one entry
- [x] Add one entry
- [x] Add one entry with current buffer content (Only Emacs has this feature!)
- [x] Delete one entry
- [x] Copy as org links (Only Emacs has this feature!)
- [x] Offline database (Sqlite)
- [x] Full update
- [x] Real time search and filter
- [x] Sidebar supported
- [x] Select with Ivy
- [x] sync with all clients (mobile, web, browser extention etc)
- [x] Support [[https://github.com/chenyanming/shrface][shrface]]
- [ ] Advanced search and filtering
- [ ] Exporting.
- [ ] Editing.
- [ ] Batch Deletion.
- [ ] Batch Tagging.
- [ ] Annotation
- [ ] Sorting.

* Installation and Configuration
This project relies on [[https://github.com/tkf/emacs-request][emacs-request]] and [[https://github.com/skeeto/emacsql][emacsql]]. Please install them in advanced.

#+begin_src sh
git clone https://github.com/chenyanming/wallabag.el.git ~/.emacs.d/lisp/wallabag/
#+end_src

** require
#+BEGIN_SRC emacs-lisp
(add-to-list 'load-path "~/.emacs.d/lisp/wallabag/")
(require 'wallabag)
(setq wallabag-host "https://xx.xx.xx") ;; wallabag server host name
(setq wallabag-username "xx") ;; username
(setq wallabag-password "xx") ;; password
(setq wallabag-clientid "xx") ;; created with API clients management
(setq wallabag-secret "xx") ;; created with API clients management
#+END_SRC

** use-package
#+begin_src emacs-lisp
(use-package wallabag
  :defer t
  :load-path "~/.emacs.d/lisp/wallabag/"
  :init
  (autoload 'wallabag "wallabag")
  :config
  (setq wallabag-host "https://xx.xx.xx") ;; wallabag server host name
  (setq wallabag-username "xx") ;; username
  (setq wallabag-password "xx") ;; password
  (setq wallabag-clientid "xx") ;; created with API clients management
  (setq wallabag-secret "xx") ;; created with API clients management
  ;; (setq wallabag-db-file "~/OneDrive/Org/wallabag.sqlite") ;; optional, default is saved to ~/.emacs.d/.cache/wallabag.sqlite
  ;; (run-with-timer 0 3540 'wallabag-request-token) ;; optional, auto refresh token, token should refresh every hour
  )
#+end_src

* Caching
Wallabag will download the images, but using Emacs [[https://www.gnu.org/software/emacs/manual/html_node/url/Disk-Caching.html][disk caching]] capability. Setting ~url-automatic-caching~ non-nil causes documents to be cached automatically.
#+begin_src emacs-lisp
(setq url-automatic-caching t)
#+end_src

* Keybindings
Start with ~M-x wallabag~. 
For the first time you connect to server, you need to press ~u~, then input the number of articles you want to retrieve from the server.
Afterwards, the number of entries is controlled by ~wallabag-number-of-entries-to-be-retrieved~, default is 50. 

PS: 
1. Network quality impacts the retrieving time. Keep ~wallabag-number-of-entries-to-be-retrieved~ as small as possible to decrease the retrieving time.
2. This package is not smart enough to know how many unretrieved entries (will be improved in
   the future). Please make sure the ~wallabag-number-of-entries-to-be-retrieved~ is larger than
   the total number of unretrieved entries.
3. The synchronization algorithm is still on development, if you want to keep local database always updated, please use ~wallabag-full-update~.
4. ~wallabag-full-update~ will always ask you to input the number of entries you want to retrieve.

** Functions can be used outside wallabag related modes
| wallabag                 | Enter ~*wallabag-search*~ buffer.                                                                        |
| wallabag-find            | Select wallabag entries from a list with ivy.                                                          |
| wallabag-full-update     | Perform a full database update. It can always keep the local database updated.                         |
| wallabag-request-token   | Request a new token.                                                                                   |
| wallabag-add-entry       | Add one entry to wallabag server, with URL and TAGS                                                    |
| wallabag-insert-entry    | Insert an entry to wallabag server with current buffer content (behavior may be changed in the future) |
| wallabag-request-entries | Retrieve the latest ~wallabag-number-of-entries-to-be-retrieved~ entries in the background.              |

** wallabag-search-mode

    | <RET>                 | wallabag-view                            | View the wallabag entry.                                             |
    | v                     | wallabag-view                            | View the wallabag entry.                                             |
    | V                     | wallabag-browse-url                      | Browse the url of current wallabag entry.                            |
    | o                     | wallabag-original-entry                  | Open the original html rendered wallabag entry.                      |
    | s (non-evil), /(evil) | wallabag-search-live-filter              | Filter the ~*wallabag-search*~ buffer.                                 |
    | q                     | wallabag-search-quit                     | Quit ~*wallabag-entry*~ then ~*wallabag-search*~ and ~*wallabag-sidebar*~. |
    | g (non-evil), r(evil) | wallabag-search-refresh-and-clear-filter | Refresh wallabag and clear the filter keyword.                       |
    | G (non-evil), R(evil) | wallabag-search-clear-filter             | Clear the filter keyword.                                            |
    | u                     | wallabag-search-update-and-clear-filter  | Request entries and clear the filter keyword.                        |
    | m                     | wallabag-mark-and-forward                | Mark entry and forward.                                              |
    | <DEL>                 | wallabag-unmark-and-backward             | Unmark entry and backword.                                           |
    | a                     | wallabag-add-entry                       | Add an entry.                                                        |
    | d                     | wallabag-delete-entry                    | Delete an entry.                                                     |
    | n(non-evil), j(evil)  | wallabag-next-entry                      | Move to next entry.                                                  |
    | p(non-evil), k(evil)  | wallabag-previous-entry                  | Move to previous entry.                                              |
    | w(non-evil), y(evil)  | wallabag-org-link-copy                   | Copy marked entries as org links.                                    |
    | t                     | wallabag-add-tags                        | Add tags (seperated by comma) to entry at point.                     |
    | T                     | wallabag-remove-tag                      | Remove one tag from list.                                            |
    | '                     | wallabag-toggle-sidebar                  | Toggle sidebar.                                                      |
    | x                     | wallabag-update-entry-archive            | Toggle archive (Read/Unread).                                        |
    | f                     | wallabag-update-entry-starred            | Toggle star (favorites).                                             |
    | i                     | wallabag-update-entry-title              | Update title.                                                        |
    | I                     | wallabag-update-entry-origin_url         | Update origin url (from where you found it).                         |

** wallabag-entry-mode
    | r       | wallabag-view           | Refresh wallabag entry.                         |
    | M-x     | wallabag-browse-url     | Browse the url of current wallabag entry.       |
    | o       | wallabag-original-entry | Open the original html rendered wallabag entry. |
    | q       | wallabag-entry-quit     | Quit ~*wallabag-entry*~.                          |
    | mouse-1 | wallabag-mouse-1        | Browse the url.                                 |
    | ret     | wallabag-ret            | Browse the url.                                 |

** wallabag-sidebar-mode

    | '                     | wallabag-toggle-sidebar            | Toggle sidebar.           |
    | <RET>                 | wallabag-sidebar-find-tag          | Filter by tag at point.   |
    | g (non-evil), r(evil) | wallabag-search-clear-filter       | Clear the filter keyword. |
    | G (non-evil), R(evil) | wallabag-search-clear-filter       | Clear the filter keyword. |
    | n                     | wallabag-sidebar-find-next-tag     | Filter by next tag.       |
    | p                     | wallabag-sidebar-find-previous-tag | Filter by previous tag.   |
    | q                     | wallabag-sidebar-quit              | Quit sidebar.             |

* Change logs
** =2021-04-13=
Version *1.0.0*:
